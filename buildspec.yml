version: 0.2

phases:
  install:
    runtime-versions:
      python: 3.9
    commands:
      - ls -lrt
      - pip install --upgrade pip
      - pip install -r requirements.txt
      - pip install pylint
      - pip install pipenv
      - pip install bandit
      - pylint --ignore=env,migrations,.ebextensions,__pycache__,static,staticfiles,templates,.gitignore,buidspec.yml,db.sqlite3 --generate-rcfile > .pylintrc
      - sed -i 's/fail-under=10/fail-under=0/g' .pylintrc
  pre_build:
    commands:
      - python --version
  build:
    commands:
      - pylint -rn --rcfile=.pylintrc *
      - bandit -iii -r . --exclude=./env,buildspec.yml,db.sqlite3,requirements.txt || true
      #- bandit -ii -r . --exclude=env,buildspec.yml,db.sqlite3,requirements.txt > bandit-output.txt
      - pipenv lock
      - pipenv requirements
      - pipenv check
      - pipenv check > pipenv-output.txt
artifacts:
  files:
    - '**/*'

ignore_exit_codes:
   - 1 #ignoring bandit exit